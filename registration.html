<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Organization Registration</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
      }
      .registration-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
      }
      .btn-primary {
        background: linear-gradient(45deg, #667eea, #764ba2);
        border: none;
        padding: 12px 30px;
        font-weight: 600;
        border-radius: 50px;
        transition: all 0.3s ease;
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }
      .icon-input {
        position: relative;
      }
      .icon-input i {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
      }
      .icon-input input {
        padding-left: 40px;
      }
      .alert {
        border-radius: 15px;
        border: none;
      }
      .header-icon {
        background: linear-gradient(45deg, #667eea, #764ba2);
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        color: white;
        font-size: 2rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8 col-sm-10">
          <div class="registration-card p-5">
            <div class="text-center mb-4">
              <div class="header-icon">
                <i class="fas fa-building"></i>
              </div>
              <h2 class="mb-2">Organization Registration</h2>
              <p class="text-muted">
                Create your organization account to get started
              </p>
            </div>

            <!-- Alert Messages -->
            <div id="alertContainer"></div>

            <form id="registrationForm">
              <div class="mb-4">
                <label for="organizationName" class="form-label fw-semibold">
                  <i class="fas fa-building me-2"></i>Organization Name
                </label>
                <div class="icon-input">
                  <i class="fas fa-building"></i>
                  <input
                    type="text"
                    class="form-control"
                    id="organizationName"
                    placeholder="Enter organization name"
                    required
                  />
                </div>
              </div>

              <div class="mb-4">
                <label for="max_users" class="form-label fw-semibold">
                  <i class="fas fa-users me-2"></i>Maximum Users
                </label>
                <div class="icon-input">
                  <i class="fas fa-users"></i>
                  <input
                    type="number"
                    class="form-control"
                    id="max_users"
                    placeholder="Enter maximum number of users"
                    min="1"
                    max="10000"
                    required
                  />
                </div>
                <div class="form-text">
                  Maximum number of users allowed in your organization
                </div>
              </div>

              <div class="mb-4">
                <label for="max_devices" class="form-label fw-semibold">
                  <i class="fas fa-mobile-alt me-2"></i>Maximum Devices per User
                </label>
                <div class="icon-input">
                  <i class="fas fa-mobile-alt"></i>
                  <input
                    type="number"
                    class="form-control"
                    id="max_devices"
                    placeholder="Enter maximum devices per user"
                    min="1"
                    max="50"
                    required
                  />
                </div>
                <div class="form-text">
                  Maximum number of devices each user can register
                </div>
              </div>

              <div class="mb-4">
                <label for="subscriptionPeriod" class="form-label fw-semibold">
                  <i class="fas fa-calendar-alt me-2"></i>Subscription Period
                  (Days)
                </label>
                <div class="icon-input">
                  <i class="fas fa-calendar-alt"></i>
                  <select class="form-control" id="subscriptionPeriod" required>
                    <option value="">Select subscription period</option>
                    <option value="30">30 Days (1 Month)</option>
                    <option value="90">90 Days (3 Months)</option>
                    <option value="180">180 Days (6 Months)</option>
                    <option value="365">365 Days (1 Year)</option>
                    <option value="730">730 Days (2 Years)</option>
                  </select>
                </div>
                <div class="form-text">
                  Duration of your subscription in days
                </div>
              </div>

              <div class="mb-4">
                <div class="card bg-light">
                  <div class="card-body">
                    <h6 class="card-title mb-3">
                      <i class="fas fa-key me-2"></i>API Key
                    </h6>
                    <p class="card-text small text-muted mb-3">
                      An API key will be automatically generated by the server
                      upon successful registration.
                    </p>
                    <div
                      class="d-flex align-items-center"
                      id="apiKeySection"
                      style="display: none !important"
                    >
                      <input
                        type="text"
                        class="form-control me-2"
                        id="generatedApiKey"
                        placeholder="Your API key will appear here"
                        readonly
                      />
                      <button
                        type="button"
                        class="btn btn-outline-secondary"
                        id="copyApiKey"
                        title="Copy API Key"
                      >
                        <i class="fas fa-copy"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-plus-circle me-2"></i>Register Organization
                </button>
              </div>
            </form>

            <div class="text-center mt-4">
              <p class="text-muted small">
                <i class="fas fa-shield-alt me-1"></i>
                Your data is secure and encrypted
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
      // Show alert message
      function showAlert(message, type = "danger") {
        const alertContainer = document.getElementById("alertContainer");
        const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${
                      type === "success"
                        ? "check-circle"
                        : type === "warning"
                        ? "exclamation-triangle"
                        : "exclamation-circle"
                    } me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        alertContainer.innerHTML = alertHtml;

        // Auto-hide after 5 seconds
        setTimeout(() => {
          const alert = alertContainer.querySelector(".alert");
          if (alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          }
        }, 5000);
      }

      // Copy API key to clipboard
      document
        .getElementById("copyApiKey")
        .addEventListener("click", function () {
          const apiKeyInput = document.getElementById("generatedApiKey");
          apiKeyInput.select();
          document.execCommand("copy");

          // Change button text temporarily
          const originalHtml = this.innerHTML;
          this.innerHTML = '<i class="fas fa-check"></i>';
          this.classList.remove("btn-outline-secondary");
          this.classList.add("btn-success");

          setTimeout(() => {
            this.innerHTML = originalHtml;
            this.classList.remove("btn-success");
            this.classList.add("btn-outline-secondary");
          }, 2000);
        });

      // Form submission
      document
        .getElementById("registrationForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const submitBtn = this.querySelector('button[type="submit"]');
          const originalBtnText = submitBtn.innerHTML;

          // Show loading state
          submitBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin me-2"></i>Registering...';
          submitBtn.disabled = true;

          // Get form data
          const formData = {
            name: document.getElementById("organizationName").value.trim(),
            max_users: parseInt(document.getElementById("max_users").value),
            max_devices: parseInt(document.getElementById("max_devices").value),
            period: parseInt(
              document.getElementById("subscriptionPeriod").value
            ),
          };

          // Basic validation
          if (
            !formData.name ||
            !formData.max_users ||
            !formData.max_devices ||
            !formData.period
          ) {
            showAlert("Please fill in all required fields.", "warning");
            submitBtn.innerHTML = originalBtnText;
            submitBtn.disabled = false;
            return;
          }

          if (formData.max_users < 1 || formData.max_users > 10000) {
            showAlert("Maximum users must be between 1 and 10,000.", "warning");
            submitBtn.innerHTML = originalBtnText;
            submitBtn.disabled = false;
            return;
          }

          if (formData.max_devices < 1 || formData.max_devices > 50) {
            showAlert(
              "Maximum devices per user must be between 1 and 50.",
              "warning"
            );
            submitBtn.innerHTML = originalBtnText;
            submitBtn.disabled = false;
            return;
          }

          try {
            // Replace with your actual API endpoint
            const response = await fetch("https://testcontent.iprep.in/api/organizations", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                'X-API-Key': 'bdcbb568-9ed3-483e-bd0d-ba65111fcbbb'
              },
              body: JSON.stringify(formData),
            });

            const result = await response.json();

            if (response.ok) {
              // Show the API key section
              document.getElementById("apiKeySection").style.display = "flex";
              document.getElementById("generatedApiKey").value = result.apiKey;

              showAlert(
                `Organization "${formData.name}" has been successfully registered! Your API key is displayed below. Please copy and save it securely.`,
                "success"
              );

              // Reset form except API key section
              this.reset();
            } else {
              // Handle different error types
              if (response.status === 409) {
                showAlert(
                  "Organization name already exists. Please choose a different name.",
                  "warning"
                );
              } else {
                showAlert(
                  result.error || "Registration failed. Please try again.",
                  "danger"
                );
              }
            }
          } catch (error) {
            console.error("Registration error:", error);
            showAlert(
              "Network error. Please check your connection and try again.",
              "danger"
            );
          } finally {
            submitBtn.innerHTML = originalBtnText;
            submitBtn.disabled = false;
          }
        });

      // Form validation feedback
      const inputs = document.querySelectorAll(
        "input[required], select[required]"
      );
      inputs.forEach((input) => {
        input.addEventListener("blur", function () {
          if (this.value.trim() === "") {
            this.classList.add("is-invalid");
          } else {
            this.classList.remove("is-invalid");
            this.classList.add("is-valid");
          }
        });
      });
    </script>
  </body>
</html>
